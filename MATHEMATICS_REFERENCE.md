# Mathematical Concepts Reference

## 1. SAMPLE SPACES & PARTITIONS

### Definition
A **partition** P = {A₁, A₂, ..., Aₙ} of sample space Ω is a collection of disjoint atoms where:
- A₁ ∪ A₂ ∪ ... ∪ Aₙ = Ω (covers all outcomes)
- Aᵢ ∩ Aⱼ = ∅ for i ≠ j (disjoint)
- Each Aᵢ is non-empty

### σ-Algebra Generated by a Partition
The σ-algebra σ(P) generated by partition P is the collection of ALL possible unions of atoms:

**σ(P) = {all finite unions of atoms in P}**

### Cardinality Formula
For a partition with n atoms, the generated σ-algebra has **exactly 2^n sets**:

|σ(P)| = 2^n

This is because each set in σ(P) is determined by choosing a subset of the n atoms to include.

### Example
Partition {A₁, A₂, A₃, A₄}:
- σ(P) contains: ∅, {A₁}, {A₂}, {A₃}, {A₄}, {A₁,A₂}, {A₁,A₃}, ... Ω
- Total: 2⁴ = 16 sets
- Properties: Always includes ∅ and Ω

---

## 2. FILTRATIONS & INFORMATION EVOLUTION

### Definition
A **filtration** {Fₜ}ₜ≥₀ is a sequence of nested σ-algebras:

**F₀ ⊆ F₁ ⊆ F₂ ⊆ ... ⊆ F**

### Interpretation
- Fₜ represents the information available at time t
- As time progresses, information only increases (never decreases)
- Each Fₜ is generated by a partition that refines over time
- Filtration captures the history of observations

### Timeline Example (from visualizer)
```
t=0: F₀ = {∅, Ω}                    (no information)
t=1: F₁ generated by {up, down}     (2 atoms, 4 sets)
t=2: F₂ generated by 4 outcomes     (4 atoms, 16 sets)
t=3: F₃ generated by 8 outcomes     (8 atoms, 256 sets)
```

### Key Property
At each time step, the partition becomes finer (more atoms), but F₀ ⊆ F₁ ⊆ F₂ ⊆ ...
always holds.

---

## 3. CONDITIONAL EXPECTATION E[X | F]

### Definition
Given random variable X and σ-algebra F, the **conditional expectation** E[X | F] is the unique 
F-measurable random variable such that for all A ∈ F:

**∫_A X dℙ = ∫_A E[X|F] dℙ**

### Practical Computation (for discrete atoms)
For each atom Aᵢ of F:

**E[X | F] = (1/|Aᵢ|) Σ_{ω∈Aᵢ} X(ω)** on atom Aᵢ

In words: On each atom, E[X|F] equals the average value of X over that atom.

### Key Properties
1. **F-measurable**: E[X|F] is constant on each atom of F
2. **Best predictor**: If you only know which atom you're in, E[X|F] is your best guess for X
3. **Tower property**: E[E[X|Fₜ]|Fₛ] = E[X|Fₛ] for s ≤ t

### Example
Suppose X(A₁)=100, X(A₂)=150, X(A₃)=120, X(A₄)=180

If F partitions into {{A₁,A₂}, {A₃,A₄}}:
- For ω ∈ {A₁, A₂}: E[X|F] = (100+150)/2 = 125
- For ω ∈ {A₃, A₄}: E[X|F] = (120+180)/2 = 150

---

## 4. MARTINGALES & RISK-NEUTRAL PRICING

### Martingale Definition
Process {Sₜ} is a **martingale** with respect to filtration {Fₜ} and probability ℙ if:
1. Sₜ is Fₜ-measurable
2. E[|Sₜ|] < ∞
3. **E[Sₜ | Fₛ] = Sₛ for all s ≤ t**

In discrete time: **E[Sₜ₊₁ | Fₜ] = Sₜ** (no drift)

### Interpretation
A martingale has no systematic tendency to increase or decrease. The expected future value 
equals the current value.

### Risk-Neutral Measure in Binomial Model
In the binomial model with parameters u, d, r:

**p* = (e^r - d)/(u - d)**

This risk-neutral probability satisfies:
- 0 < p* < 1 (valid probability)
- Under this probability, the discounted price process is a martingale
- e^r = p*·u + (1-p*)·d (expected growth matches risk-free rate)

### Martingale Property in Binomial Trees
Under risk-neutral measure ℚ with probability p*:

**E^ℚ[Sₜ₊₁ | Fₜ] = e^(-r) · Sₜ**

This means discounted prices are exact martingales.

---

## 5. BINOMIAL OPTION PRICING

### Binomial Tree Structure
- Time periods: t = 0, 1, 2, ..., T
- At each period, stock can move:
  - UP: Sₜ₊₁ = Sₜ · u (with probability p*)
  - DOWN: Sₜ₊₁ = Sₜ · d (with probability 1-p*)
- Total paths: 2^T

### Stock Price at Terminal Node
If there are i up moves and (t-i) down moves by time t:

**Sₜ(i) = S₀ · u^i · d^(t-i)**

### European Call Option
- **Payoff at maturity**: C_T = max(S_T - K, 0)
- **Price at node**: C_t = e^(-r) · [p* · C_{t,up} + (1-p*) · C_{t,down}]
- **Computation**: Backward induction from terminal nodes to t=0

### Backward Induction Algorithm
```
1. Calculate terminal payoffs: C_T(i) = max(S_T(i) - K, 0) for all i
2. For t = T-1 down to 0:
   For each node (t, i):
     C_t(i) = e^(-r) · [p* · C_{t+1,up} + (1-p*) · C_{t+1,down}]
3. Call price = C_0(0)
```

### Example (T=2, S₀=100, K=100, u=1.2, d=0.8, r=0.05)
```
Terminal: S_uu = 144, S_ud = 96, S_dd = 64
Payoffs: C_uu = 44, C_ud = 0, C_dd = 0
p* = (e^0.05 - 0.8)/(1.2 - 0.8) ≈ 0.6281
At t=1:
  C_u = e^(-0.05)[0.6281·44 + 0.3719·0] ≈ 27.05
  C_d = e^(-0.05)[0.6281·0 + 0.3719·0] = 0
At t=0:
  C₀ = e^(-0.05)[0.6281·27.05 + 0.3719·0] ≈ 16.66
```

---

## KEY FORMULAS REFERENCE

### σ-Algebra Cardinality
|σ(P)| = 2^n, where n = |P| (number of atoms)

### Risk-Neutral Probability
p* = (e^(rΔt) - d)/(u - d)

### Binomial Pricing (General)
C_t = e^(-r(T-t)) · E^ℚ[payoff(S_T) | F_t]

### Conditional Expectation on Atoms
E[X | F](ω) = (1/|A|) Σ_{ω'∈A} X(ω') where A is the atom containing ω

### Stock Price in Binomial Tree
S_t(i) = S₀ · u^i · d^(t-i), where i = number of up moves

### Martingale Property
E[S_{t+1} | F_t] = S_t (under appropriate measure)

---

## MATHEMATICAL INTUITION

### Partitions & σ-Algebras
Think of a partition as describing what you can "see" in the sample space. A finer partition 
means you can distinguish more outcomes. The σ-algebra contains all questions you can answer 
with the information in the partition.

### Filtrations
A filtration is like gaining new information over time. At each step, your partition becomes 
finer (you can distinguish more outcomes), but you never forget what you learned before.

### Conditional Expectation
E[X | F] is your best guess for X if you only know which atom of F you're in. It's the 
optimal prediction given the information in F.

### Martingales
A martingale is a "fair game" - on average, the process doesn't systematically increase or 
decrease. Under the risk-neutral measure, stock prices adjusted for the risk-free rate form 
a martingale.

### Option Pricing
Option prices can be computed by working backwards from terminal payoffs, discounting at the 
risk-free rate, and using risk-neutral probabilities. This works because the market is 
"arbitrage-free" under these probabilities.

---

## CONNECTIONS BETWEEN CONCEPTS

1. **Partitions → Filtrations**
   - Partitions at different times form a filtration
   - Refinement of partitions corresponds to nesting of σ-algebras

2. **Filtrations → Conditional Expectation**
   - Conditional expectation is computed with respect to a σ-algebra (from the filtration)
   - E[X | Fₜ] is the best prediction using only information in Fₜ

3. **Conditional Expectation → Martingales**
   - A martingale property involves conditional expectations
   - E[Sₜ₊₁ | Fₜ] = Sₜ is the defining property

4. **Martingales → Option Pricing**
   - Risk-neutral probabilities make discounted prices into martingales
   - Martingale property enables option pricing via backward induction

5. **Binomial Trees → All Concepts**
   - The binomial tree is a concrete example of all these abstract concepts
   - Visualizing it helps understand the mathematical structure

---

## RELATED TOPICS NOT COVERED (Future Extensions)

- Continuous-time processes (Brownian motion, Itô's lemma)
- American option pricing (optimal stopping)
- Stochastic differential equations (SDEs)
- Girsanov's theorem (change of measure)
- Ito integrals and stochastic calculus
- Multi-dimensional processes
- Jump processes and Lévy processes

---

For more details, see README.md and the mathematical definitions sections on each page.
